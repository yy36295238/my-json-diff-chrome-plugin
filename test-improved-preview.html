<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹è¿›åçš„JSONæ ¼å¼åŒ–é¢„è§ˆæµ‹è¯•</title>
    <link rel="stylesheet" href="styles-simple.css">
    <style>
        body {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .test-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .test-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .panel-header {
            background: var(--primary-color);
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-content {
            padding: 16px;
        }

        .test-textarea {
            width: 100%;
            height: 300px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            resize: vertical;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            flex-wrap: wrap;
        }

        .test-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .test-button.primary {
            background: var(--primary-color);
            color: white;
        }

        .test-button.secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .test-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .preview-area {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            height: 400px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .preview-body {
            flex: 1;
            overflow: auto;
            padding: 0;
        }

        .test-status {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
            font-family: var(--font-mono);
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }

        .status-item {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .status-success {
            background: rgba(var(--success-color-rgb), 0.1);
            color: var(--success-color);
        }

        .status-error {
            background: rgba(var(--error-color-rgb), 0.1);
            color: var(--error-color);
        }

        .status-info {
            background: rgba(var(--primary-color-rgb), 0.1);
            color: var(--primary-color);
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }

        .metric-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ› ï¸ æ”¹è¿›åçš„JSONæ ¼å¼åŒ–é¢„è§ˆåŠŸèƒ½æµ‹è¯•</h1>

    <div class="metrics">
        <div class="metric-card">
            <div class="metric-value" id="nodeCount">0</div>
            <div class="metric-label">èŠ‚ç‚¹æ•°é‡</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="maxDepth">0</div>
            <div class="metric-label">æœ€å¤§æ·±åº¦</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="collapsibleCount">0</div>
            <div class="metric-label">å¯æŠ˜å é¡¹</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="renderTime">0ms</div>
            <div class="metric-label">æ¸²æŸ“æ—¶é—´</div>
        </div>
    </div>

    <div class="test-layout">
        <!-- å·¦ä¾§ï¼šJSONè¾“å…¥ -->
        <div class="test-panel">
            <div class="panel-header">
                <span>ğŸ“ JSONæ•°æ®è¾“å…¥</span>
                <span id="jsonStatus">ç­‰å¾…è¾“å…¥</span>
            </div>
            <div class="panel-content">
                <textarea class="test-textarea" id="jsonInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥JSONæ•°æ®...">
{
    "application": {
        "name": "JSONå·¥å…·ç®€åŒ–ç‰ˆ",
        "version": "2.0.0",
        "description": "ä¸“ä¸šçº§JSONå¤„ç†å¹³å°",
        "features": {
            "formatting": true,
            "comparison": true,
            "generation": true,
            "preview": {
                "collapsible": true,
                "syntax_highlighting": true,
                "tree_view": true,
                "auto_height": true
            }
        },
        "supported_data_types": [
            "string",
            "number",
            "boolean",
            "null",
            "object",
            "array"
        ],
        "configuration": {
            "theme": {
                "default": "light",
                "options": ["light", "dark"]
            },
            "editor": {
                "font_family": "Monaco, Menlo, monospace",
                "font_size": 14,
                "line_height": 1.6,
                "tab_size": 2
            },
            "preview": {
                "max_items_preview": 100,
                "auto_collapse_large_arrays": true,
                "show_data_types": true,
                "show_object_counts": true
            }
        },
        "test_data": {
            "users": [
                {
                    "id": 1,
                    "username": "admin",
                    "profile": {
                        "firstName": "ç®¡ç†å‘˜",
                        "lastName": "ç”¨æˆ·",
                        "email": "admin@example.com",
                        "preferences": {
                            "language": "zh-CN",
                            "timezone": "Asia/Shanghai",
                            "notifications": {
                                "email": true,
                                "sms": false,
                                "push": true
                            }
                        }
                    },
                    "permissions": ["read", "write", "delete", "admin"],
                    "last_login": "2024-01-01T12:00:00Z",
                    "active": true
                },
                {
                    "id": 2,
                    "username": "user1",
                    "profile": {
                        "firstName": "å¼ ",
                        "lastName": "ä¸‰",
                        "email": "zhangsan@example.com",
                        "preferences": {
                            "language": "zh-CN",
                            "timezone": "Asia/Shanghai",
                            "notifications": {
                                "email": false,
                                "sms": true,
                                "push": false
                            }
                        }
                    },
                    "permissions": ["read", "write"],
                    "last_login": "2024-01-02T08:30:00Z",
                    "active": true
                }
            ],
            "statistics": {
                "total_users": 2,
                "active_users": 2,
                "last_updated": "2024-01-01T00:00:00Z"
            }
        }
    }
}
                </textarea>

                <div class="button-group">
                    <button class="test-button primary" onclick="updatePreview()">ğŸ”„ æ›´æ–°é¢„è§ˆ</button>
                    <button class="test-button secondary" onclick="formatJSON()">âœ¨ æ ¼å¼åŒ–</button>
                    <button class="test-button secondary" onclick="compressJSON()">ğŸ“¦ å‹ç¼©</button>
                    <button class="test-button secondary" onclick="validateJSON()">âœ… éªŒè¯</button>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šé¢„è§ˆåŒºåŸŸ -->
        <div class="test-panel">
            <div class="panel-header">
                <span>ğŸ‘ï¸ æ ¼å¼åŒ–é¢„è§ˆ</span>
                <div class="button-group" style="margin: 0;">
                    <button class="test-button secondary" style="padding: 4px 8px; font-size: 12px;" onclick="expandAll()">å±•å¼€</button>
                    <button class="test-button secondary" style="padding: 4px 8px; font-size: 12px;" onclick="collapseAll()">æŠ˜å </button>
                    <button class="test-button secondary" style="padding: 4px 8px; font-size: 12px;" onclick="toggleTreeView()">æ ‘å½¢</button>
                </div>
            </div>
            <div class="panel-content" style="padding: 0;">
                <div class="preview-area">
                    <div class="preview-header">
                        <span>ç»“æ„é¢„è§ˆ</span>
                        <span id="previewStats">ç­‰å¾…æ•°æ®</span>
                    </div>
                    <div class="preview-body">
                        <div id="jsonPreview" class="json-preview" style="min-height: 350px; height: auto;">
                            <div style="padding: 40px; text-align: center; color: var(--text-muted);">
                                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
                                <div>åœ¨å·¦ä¾§è¾“å…¥JSONæ•°æ®å¼€å§‹é¢„è§ˆ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æµ‹è¯•çŠ¶æ€ -->
    <div class="test-panel">
        <div class="panel-header">
            <span>ğŸ“Š æµ‹è¯•çŠ¶æ€å’Œæ—¥å¿—</span>
            <button class="test-button secondary" style="padding: 4px 8px; font-size: 12px;" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        <div class="panel-content">
            <div class="test-status" id="testLog">
                <div class="status-info">ğŸ“± ç³»ç»Ÿå·²å°±ç»ªï¼Œç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
    </div>

    <script src="scripts.js"></script>
    <script>
        // åˆå§‹åŒ–åº”ç”¨
        const jsonTool = new JSONToolApp();
        let renderStartTime = 0;

        // æ—¥å¿—åŠŸèƒ½
        function addLog(message, type = 'info') {
            const log = document.getElementById('testLog');
            const time = new Date().toLocaleTimeString();
            const statusClass = type === 'error' ? 'status-error' :
                               type === 'success' ? 'status-success' : 'status-info';

            const logItem = document.createElement('div');
            logItem.className = `status-item ${statusClass}`;
            logItem.innerHTML = `[${time}] ${message}`;

            log.appendChild(logItem);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '<div class="status-info">ğŸ“± æ—¥å¿—å·²æ¸…é™¤</div>';
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateMetrics(data) {
            try {
                const json = JSON.parse(data);
                const nodeCount = countNodes(json);
                const maxDepth = getMaxDepth(json);
                const collapsibleElements = document.querySelectorAll('.json-collapsible').length;
                const renderTime = Date.now() - renderStartTime;

                document.getElementById('nodeCount').textContent = nodeCount;
                document.getElementById('maxDepth').textContent = maxDepth;
                document.getElementById('collapsibleCount').textContent = collapsibleElements;
                document.getElementById('renderTime').textContent = renderTime + 'ms';

                document.getElementById('previewStats').textContent =
                    `${nodeCount}ä¸ªèŠ‚ç‚¹ | ${maxDepth}å±‚æ·±åº¦ | ${collapsibleElements}ä¸ªå¯æŠ˜å é¡¹`;
            } catch (error) {
                // å¿½ç•¥é”™è¯¯
            }
        }

        function countNodes(obj) {
            if (obj === null || typeof obj !== 'object') return 1;
            let count = 1;
            for (let key in obj) {
                count += countNodes(obj[key]);
            }
            return count;
        }

        function getMaxDepth(obj, depth = 0) {
            if (obj === null || typeof obj !== 'object') return depth;
            let maxDepth = depth;
            for (let key in obj) {
                maxDepth = Math.max(maxDepth, getMaxDepth(obj[key], depth + 1));
            }
            return maxDepth;
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const input = document.getElementById('jsonInput').value.trim();
            const preview = document.getElementById('jsonPreview');
            const status = document.getElementById('jsonStatus');

            if (!input) {
                preview.innerHTML = '<div style="padding: 40px; text-align: center; color: var(--text-muted);"><div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div><div>è¯·è¾“å…¥JSONæ•°æ®</div></div>';
                status.textContent = 'ç­‰å¾…è¾“å…¥';
                status.style.color = 'var(--text-secondary)';
                addLog('é¢„è§ˆåŒºåŸŸå·²æ¸…ç©º');
                return;
            }

            try {
                renderStartTime = Date.now();
                const parsed = JSON.parse(input);
                preview.innerHTML = jsonTool.renderJSONTree(parsed);

                status.textContent = 'âœ… æœ‰æ•ˆ';
                status.style.color = 'var(--success-color)';

                updateMetrics(input);
                addLog('JSONé¢„è§ˆæ›´æ–°æˆåŠŸ', 'success');
            } catch (error) {
                preview.innerHTML = `<div style="padding: 20px; color: var(--error-color);"><strong>âŒ JSONè§£æé”™è¯¯</strong><br><br>${error.message}</div>`;
                status.textContent = 'âŒ æ— æ•ˆ';
                status.style.color = 'var(--error-color)';
                addLog(`JSONè§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ ¼å¼åŒ–JSON
        function formatJSON() {
            const input = document.getElementById('jsonInput');
            try {
                const parsed = JSON.parse(input.value);
                input.value = JSON.stringify(parsed, null, 2);
                updatePreview();
                addLog('JSONæ ¼å¼åŒ–æˆåŠŸ', 'success');
            } catch (error) {
                addLog(`æ ¼å¼åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å‹ç¼©JSON
        function compressJSON() {
            const input = document.getElementById('jsonInput');
            try {
                const parsed = JSON.parse(input.value);
                input.value = JSON.stringify(parsed);
                updatePreview();
                addLog('JSONå‹ç¼©æˆåŠŸ', 'success');
            } catch (error) {
                addLog(`å‹ç¼©å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // éªŒè¯JSON
        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            try {
                JSON.parse(input);
                addLog('âœ… JSONæ ¼å¼éªŒè¯é€šè¿‡', 'success');
            } catch (error) {
                addLog(`âŒ JSONéªŒè¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å±•å¼€æ‰€æœ‰
        function expandAll() {
            jsonTool.expandAll();
            addLog('å·²å±•å¼€æ‰€æœ‰èŠ‚ç‚¹', 'info');
        }

        // æŠ˜å æ‰€æœ‰
        function collapseAll() {
            jsonTool.collapseAll();
            addLog('å·²æŠ˜å æ‰€æœ‰èŠ‚ç‚¹', 'info');
        }

        // åˆ‡æ¢æ ‘å½¢è§†å›¾
        function toggleTreeView() {
            jsonTool.toggleTreeView();
            const preview = document.getElementById('jsonPreview');
            const isTreeView = preview.classList.contains('tree-view');
            addLog(`å·²åˆ‡æ¢åˆ°${isTreeView ? 'æ ‘å½¢' : 'æ™®é€š'}è§†å›¾`, 'info');
        }

        // è¾“å…¥å®æ—¶ç›‘å¬
        document.getElementById('jsonInput').addEventListener('input', function() {
            clearTimeout(this.updateTimer);
            this.updateTimer = setTimeout(updatePreview, 300);
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            addLog('ğŸš€ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ', 'success');
            setTimeout(updatePreview, 500);
        });
    </script>
</body>
</html>